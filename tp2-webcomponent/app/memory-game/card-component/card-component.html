<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../bower_components/iron-signals/iron-signals.html">
<dom-module id="card-component">
    <link rel="import" type="css" href="style.css">
    <template>
        <iron-signals on-iron-signal-flip-back="flipBack"></iron-signals>
        <iron-signals on-iron-signal-flip="flip"></iron-signals>
        <!-- Notre carte lance la fonction flip sur l'évènement click-->
        <div class="card" on-click="click">
            <div class="flip">
                <paper-material elevation="3"  class="front">
                    <paper-ripple></paper-ripple>
                    <p>{{family}}</p>
                </paper-material>
                <paper-material elevation="3"  class="back">
                    <paper-ripple></paper-ripple>
                </paper-material>
            </div>
        </div>
    </template>

    <script>
        var CardComponent = Polymer({
            is : "card-component",
            properties : {
                family : {
                    value : ""
                }
            },
            factoryImpl: function(family, backgroundColor) {
                this.family = family;
                Polymer.dom(this.root).querySelector('.front').style.backgroundColor = backgroundColor;
            },
            id : "",
            disabled : false,
            //évènement à la création du composant
            created: function() {
                //Initialisation d'un id unique
                this.id = Math.random();
            },
            // fonction lors du clic sur la carte
            click : function (event){
                // si le booléen disabled est à false et que la carte n'est pas encore retourné on la retourne
                if(!this.disabled && !(Polymer.dom(this.root).querySelector('.front').className.indexOf('flippedFront')>-1)){
                    this.flip(event);
                    //On lance un évènement "check" pour donner les caractéristiques de la carte retounée
                    var dataSend ={ id : this.id, family : this.family  };
                    this.fire("card-clicked", dataSend );
                }
            },
            //fonction pour cacher la carte
            flipBack : function (event, detail) {
                if(this.id == detail.id) {
                    this.flip(event);
                }
            },
            //fonction pour faire un toggle de la carte
            flip : function (event) {
                //On toggle la classe flippedFront
                Polymer.dom(this.root).querySelector('.front').classList.toggle('flippedFront');
                //On toggle la classe flippedBack
                Polymer.dom(this.root).querySelector('.back').classList.toggle('flippedBack');
            }
        });
    </script>
</dom-module>